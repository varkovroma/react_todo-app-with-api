(this["webpackJsonpreact_todo-app-with-api"]=this["webpackJsonpreact_todo-app-with-api"]||[]).push([[0],{27:function(e,t,n){},31:function(e,t,n){},32:function(e,t,n){"use strict";n.r(t);var c=n(15),r=(n(25),n(26),n(27),n(5)),a=n(3),o=n(2),s=n.n(o),i=n(1),l=n.n(i),u=n(4),d=n.n(u),f="https://mate.academy/students-api";function j(e){return new Promise((function(t){setTimeout(t,e)}))}function b(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c={method:t};return n&&(c.body=JSON.stringify(n),c.headers={"Content-Type":"application/json; charset=UTF-8"}),j(300).then((function(){return fetch(f+e,c)})).then((function(e){if(!e.ok)throw new Error;return e.json()}))}var p,m=function(e){return b(e)},h=function(e,t){return b(e,"POST",t)},O=function(e,t){return b(e,"PATCH",t)},v=function(e){return b(e,"DELETE")},x=function(){var e=Object(r.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m("/users?email=".concat(t));case 2:return n=e.sent,e.abrupt("return",n[0]||null);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=Object(r.a)(s.a.mark((function e(t){var n,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.email,c=t.name,e.abrupt("return",h("/users",{email:n,name:c}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=n(0),y=function(e){var t=e.onLogin,n=Object(i.useState)(""),c=Object(a.a)(n,2),o=c[0],l=c[1],u=Object(i.useState)(""),f=Object(a.a)(u,2),j=f[0],b=f[1],p=Object(i.useState)(!1),m=Object(a.a)(p,2),h=m[0],O=m[1],v=Object(i.useState)(!1),y=Object(a.a)(v,2),T=y[0],k=y[1],C=Object(i.useState)(""),w=Object(a.a)(C,2),S=w[0],_=w[1],E=function(e){localStorage.setItem("user",JSON.stringify(e)),t(e)};Object(i.useEffect)((function(){var e=localStorage.getItem("user");if(e)try{var n=JSON.parse(e);t(n)}catch(c){}}),[]);var A=function(){var e=Object(r.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(o);case 2:(t=e.sent)?E(t):O(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),I=function(){var e=Object(r.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),_(""),k(!0),e.prev=3,!h){e.next=9;break}return e.next=7,g({name:j,email:o}).then(E);case 7:e.next=11;break;case 9:return e.next=11,A();case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),_("Something went wrtong");case 16:return e.prev=16,k(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[3,13,16,19]])})));return function(t){return e.apply(this,arguments)}}();return Object(N.jsxs)("form",{onSubmit:I,className:"box mt-5",children:[Object(N.jsx)("h1",{className:"title is-3",children:h?"You need to register":"Log in to open todos"}),Object(N.jsxs)("div",{className:"field",children:[Object(N.jsx)("label",{className:"label",htmlFor:"user-email",children:"Email"}),Object(N.jsxs)("div",{className:d()("control has-icons-left",{"is-loading":T}),children:[Object(N.jsx)("input",{type:"email",id:"user-email",className:d()("input",{"is-danger":!h&&S}),placeholder:"Enter your email",disabled:T||h,value:o,required:!0,onChange:function(e){return l(e.target.value)}}),Object(N.jsx)("span",{className:"icon is-small is-left",children:Object(N.jsx)("i",{className:"fas fa-envelope"})})]}),!h&&S&&Object(N.jsx)("p",{className:"help is-danger",children:S})]}),h&&Object(N.jsxs)("div",{className:"field",children:[Object(N.jsx)("label",{className:"label",htmlFor:"user-name",children:"Your Name"}),Object(N.jsxs)("div",{className:d()("control has-icons-left",{"is-loading":T}),children:[Object(N.jsx)("input",{type:"text",id:"user-name",className:d()("input",{"is-danger":h&&S}),placeholder:"Enter your name",required:!0,minLength:4,disabled:T,value:j,onChange:function(e){return b(e.target.value)}}),Object(N.jsx)("span",{className:"icon is-small is-left",children:Object(N.jsx)("i",{className:"fas fa-user"})})]}),h&&S&&Object(N.jsx)("p",{className:"help is-danger",children:S})]}),Object(N.jsx)("div",{className:"field",children:Object(N.jsx)("button",{type:"submit",className:d()("button is-primary",{"is-loading":T}),children:h?"Register":"Login"})})]})},T=l.a.createContext(null),k=function(e){var t=e.children,n=Object(i.useState)(null),c=Object(a.a)(n,2),r=c[0],o=c[1];return r?Object(N.jsx)(T.Provider,{value:r,children:t}):Object(N.jsx)(y,{onLogin:o})},C=n(16),w=function(e){return m("/todos?userId=".concat(e))},S=function(e,t){return h("/todos",{title:e,userId:t,completed:!1})},_=function(e){return v("/todos/".concat(e))},E=function(e,t){return O("/todos/".concat(e),t)};!function(e){e.ErrorTitle="Title cannot be empty",e.NotAdd="Unable to add a todo",e.NotDelete="Unable to delete a todo",e.NotUpdate="Unable to update a todo"}(p||(p={}));var A,I=function(e){var t=e.newTodoField,n=e.setTitle,c=e.title,a=e.handleAllCompleted,o=e.todos,l=e.isAdding,u=e.setIsAdding,f=e.user,j=e.setErrorMessage,b=e.setTodos;Object(i.useEffect)((function(){t.current&&t.current.focus()}),[l]);var m=Object(i.useCallback)(function(){var e=Object(r.a)(s.a.mark((function e(t){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),c.trim()&&f){e.next=4;break}return j(p.ErrorTitle),e.abrupt("return");case 4:return u(!0),e.prev=5,e.next=8,S(c,f.id);case 8:r=e.sent,b((function(e){return[].concat(Object(C.a)(e),[r])})),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(5),j(p.NotAdd);case 15:u(!1),n("");case 17:case"end":return e.stop()}}),e,null,[[5,12]])})));return function(t){return e.apply(this,arguments)}}(),[c,f]);return Object(N.jsxs)("header",{className:"todoapp__header",children:[Object(N.jsx)("button",{"data-cy":"ToggleAllButton",type:"button",className:d()("todoapp__toggle-all",{active:o.every((function(e){return e.completed}))}),"aria-label":"close",onClick:a}),Object(N.jsx)("form",{onSubmit:m,children:Object(N.jsx)("input",{"data-cy":"NewTodoField",type:"text",ref:t,className:"todoapp__new-todo",placeholder:"What needs to be done?",value:c,onChange:function(e){var t=e.target.value;n(t)},disabled:l})})]})},M=n(35),F=n(34),L=function(){return Object(N.jsxs)("div",{"data-cy":"TodoLoader",className:"modal overlay is-active",children:[Object(N.jsx)("div",{className:"modal-background has-background-white-ter"}),Object(N.jsx)("div",{className:"loader"})]})};!function(e){e.Escape="Escape",e.Enter="Enter"}(A||(A={}));var D,U=function(e){var t=e.todo,n=e.todos,c=e.removeTodo,r=e.selectedId,o=e.isAdding,s=e.handleChange,l=e.selectedTodo,u=e.setSelectedTodo,f=Object(i.useState)(!1),j=Object(a.a)(f,2),b=j[0],p=j[1],m=Object(i.useState)(""),h=Object(a.a)(m,2),O=h[0],v=h[1],x=Object(i.useRef)(null),g=t.title,y=t.id,T=t.completed,k=Object(i.useMemo)((function(){return r.includes(y)||o&&0===y}),[o,r,y]),C=Object(i.useCallback)((function(){if(!O)return c(l),void p(!1);O!==t.title?(n.find((function(e){return e.title===O}))&&(p(!1),u(0)),s(l,{title:O}),p(!1),v(""),u(0)):p(!1)}),[O,l,b]),w=Object(i.useCallback)((function(){p(!0),u(y),v(t.title)}),[b]);return Object(i.useEffect)((function(){x.current&&x.current.focus()}),[l]),Object(N.jsxs)("div",{className:d()("todo",{completed:T}),"data-cy":"Todo",children:[Object(N.jsx)("label",{className:"todo__status-label",children:Object(N.jsx)("input",{type:"checkbox",className:"todo__status","data-cy":"TodoStatus",checked:T,onChange:function(){return s(y,{completed:!T})}})}),b&&l===y?Object(N.jsx)("form",{onSubmit:function(e){e.preventDefault()},children:Object(N.jsx)("input",{"data-cy":"TodoTitleField",type:"text",ref:x,className:"todo__title-field",value:O,placeholder:"Employ todo will be deleted",onChange:function(e){v(e.target.value)},onBlur:function(){C(),p(!1)},onKeyDown:function(e){e.key===A.Escape&&p(!1),e.key===A.Enter&&C()}})}):Object(N.jsxs)(N.Fragment,{children:[Object(N.jsx)("span",{"data-cy":"TodoTitle",className:"todo__title",onDoubleClick:w,children:g}),Object(N.jsx)("button",{type:"button",className:"todo__remove","data-cy":"TodoDeleteButton",onClick:function(){c(y)},children:"\xd7"})]}),k&&Object(N.jsx)(L,{})]},y)},B=(n(31),function(e){var t=e.todos,n=e.removeTodo,c=e.selectedId,r=e.isAdding,a=e.title,o=e.handleChange,s=e.selectedTodo,i=e.setSelectedTodo;return Object(N.jsx)("section",{className:"todoapp__main","data-cy":"TodoList",children:Object(N.jsxs)(M.a,{children:[t.map((function(e){return Object(N.jsx)(F.a,{timeout:300,classNames:"item",children:Object(N.jsx)(U,{todo:e,removeTodo:n,selectedId:c,isAdding:r,handleChange:o,todos:t,selectedTodo:s,setSelectedTodo:i},e.id)},e.id)})),r&&Object(N.jsx)(F.a,{timeout:300,classNames:"temp-item",children:Object(N.jsx)(U,{todo:{id:0,title:a,completed:!1,userId:Math.random()},removeTodo:n,selectedId:c,isAdding:r,handleChange:o,todos:t,selectedTodo:s,setSelectedTodo:i},Math.random())},0)]})})}),P=function(e){var t=e.errorMessage,n=e.setErrorMessage,c=Object(i.useState)(!1),r=Object(a.a)(c,2),o=r[0],s=r[1];return Object(i.useEffect)((function(){var e=setTimeout((function(){return n("")}),3e3);return function(){clearTimeout(e)}}),[t,o]),Object(N.jsxs)("div",{className:d()("notification","is-danger","is-light","has-text-weight-normal",{hidden:o}),"data-cy":"ErrorNotification",children:[Object(N.jsx)("button",{"data-cy":"HideErrorButton",type:"button",className:"delete",onClick:function(){return s(!0)},"aria-label":"close"}),t]})};!function(e){e.All="all",e.Active="active",e.Completed="completed"}(D||(D={}));var J=function(e){var t=e.todos,n=e.filterType,c=e.filterTypes,a=e.completedTodos,o=e.setSelectedId,l=e.selectedId,u=e.setErrorMessage,f=e.errorMessage,j=e.setTodos,b=Object(i.useMemo)((function(){return t.filter((function(e){return!e.completed})).length}),[t]),m=Object(i.useCallback)(Object(r.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o(a.map((function(e){return e.id}))),e.next=3,Promise.all(a.map((function(e){var t=e.id;return _(t)}))).then((function(){return j((function(e){return e.filter((function(e){return!e.completed}))}))})).catch((function(){u(p.NotDelete),o([])}));case 3:o([]);case 4:case"end":return e.stop()}}),e)}))),[t,l,f]);return Object(N.jsxs)("footer",{className:"todoapp__footer","data-cy":"Footer",children:[Object(N.jsx)("span",{className:"todo-count","data-cy":"todosCounter",children:"".concat(b," items left")}),Object(N.jsxs)("nav",{className:"filter","data-cy":"Filter",children:[Object(N.jsx)("a",{"data-cy":"FilterLinkAll",href:"#/",className:d()("filter__link",{selected:n===D.All}),onClick:function(){return c(D.All)},children:"All"}),Object(N.jsx)("a",{"data-cy":"FilterLinkActive",href:"#/active",className:d()("filter__link",{selected:n===D.Active}),onClick:function(){return c(D.Active)},children:"Active"}),Object(N.jsx)("a",{"data-cy":"FilterLinkCompleted",href:"#/completed",className:d()("filter__link",{selected:n===D.Completed}),onClick:function(){return c(D.Completed)},children:"Completed"})]}),Object(N.jsx)("button",{"data-cy":"ClearCompletedButton",type:"button",className:"todoapp__clear-completed",onClick:m,disabled:!a,children:"Clear completed"})]})},R=function(){var e=Object(i.useRef)(null),t=Object(i.useState)([]),n=Object(a.a)(t,2),c=n[0],o=n[1],l=Object(i.useState)(""),u=Object(a.a)(l,2),d=u[0],f=u[1],j=Object(i.useState)(D.All),b=Object(a.a)(j,2),m=b[0],h=b[1],O=Object(i.useState)(""),v=Object(a.a)(O,2),x=v[0],g=v[1],y=Object(i.useState)([]),k=Object(a.a)(y,2),C=k[0],S=k[1],A=Object(i.useState)(!1),M=Object(a.a)(A,2),F=M[0],L=M[1],U=Object(i.useState)(!0),R=Object(a.a)(U,2),q=R[0],H=R[1],Y=Object(i.useState)(0),G=Object(a.a)(Y,2),K=G[0],W=G[1],z=Object(i.useContext)(T);Object(i.useEffect)((function(){var e=function(){var e=Object(r.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w(t);case 3:n=e.sent,o(n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),f("".concat(e.t0));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}();z&&e(z.id)}),[]);var Q=Object(i.useMemo)((function(){return c.filter((function(e){switch(m){case D.Active:return!e.completed;case D.Completed:return e.completed;default:return!0}}))}),[c,m]),V=Object(i.useCallback)(function(){var e=Object(r.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S([t]),e.prev=1,e.next=4,_(t);case 4:o((function(e){return e.filter((function(e){return e.id!==t}))})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),f(p.NotDelete);case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}(),[c,d]),X=Object(i.useMemo)((function(){return c.filter((function(e){return e.completed}))}),[c]),Z=Object(i.useCallback)(function(){var e=Object(r.a)(s.a.mark((function e(t,n){var c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S([t]),e.prev=1,e.next=4,E(t,n);case 4:c=e.sent,o((function(e){return e.map((function(e){return e.id===t?c:e}))})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),f(p.NotUpdate);case 11:S([]);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,n){return e.apply(this,arguments)}}(),[c]),$=function(){var e=Object(r.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return X.length===c.length?S(c.map((function(e){return e.id}))):S(c.filter((function(e){return!e.completed})).map((function(e){return e.id}))),e.prev=1,e.next=4,Promise.all(c.map((function(e){return e.completed!==q?E(e.id,{completed:q}):e})));case 4:t=e.sent,o(t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),f(p.NotUpdate);case 11:H(!q),S([]);case 13:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}();return Object(N.jsxs)("div",{className:"todoapp",children:[Object(N.jsx)("h1",{className:"todoapp__title",children:"todos"}),Object(N.jsxs)("div",{className:"todoapp__content",children:[Object(N.jsx)(I,{newTodoField:e,setTitle:g,title:x,setIsAdding:L,handleAllCompleted:$,todos:c,isAdding:F,user:z,setErrorMessage:f,setTodos:o}),(F||c.length>0)&&Object(N.jsxs)(N.Fragment,{children:[Object(N.jsx)(B,{todos:Q,removeTodo:V,selectedId:C,isAdding:F,title:x,handleChange:Z,selectedTodo:K,setSelectedTodo:W}),Object(N.jsx)(J,{filterType:m,filterTypes:h,todos:c,completedTodos:X,setTodos:o,setErrorMessage:f,errorMessage:d,setSelectedId:S,selectedId:C})]})]}),d&&Object(N.jsx)(P,{errorMessage:d,setErrorMessage:f})]})},q=function(){return Object(N.jsx)(k,{children:Object(N.jsx)(R,{})})};Object(c.createRoot)(document.getElementById("root")).render(Object(N.jsx)(q,{}))}},[[32,1,2]]]);
//# sourceMappingURL=main.79264ddf.chunk.js.map